---
cover: assets/img/covers/security_incident.png
description: Checklist of actions for responding to a security incident at PagerDuty.
---
<div id="reviewed-dates">
  <span><strong>Last Reviewed:</strong> <abbr title="We recommend you include with this document the date you last reviewed your process.">YYYY-MM-DD</abbr></span>
  <span><strong>Last Tested:</strong> <abbr title="We recommend you include with this document the date you last tested your process.">YYYY-MM-DD</abbr></span>
</div>

!!! warning "インシデントコマンダーは必須です"
    PagerDutyにおける全ての重大インシデントと同じように、タスクを適切に移譲できるセキュリティインシデントもインシデントコマンダーが必要です。
    インシデントコマンダーに割り振られたタスクは並列に実行できます。
    `!ic page` コマンドで 可能な限り早く呼び出してください。

!!! question "セキュリティインシデントかどうかわからない"
    とにかく対応を開始してください。
    それは謝るよりも良いことです。
    インシデントコマンダーが対応が必要かどうかを判断します。

## チェックリスト

これらのチェックリストは次の節で詳しく説明します。

1. 現在の攻撃を停止する
1. 攻撃ベクターを遮断する
1. 対応チームを組む
1. 攻撃を受けたインスタンスを隔離する
1. 攻撃のタイムラインを明確にする
1. 漏洩したデータを特定する
1. 他のシステムへのリスクを評価する
1. 再攻撃のリスクを評価する
1. 追加の措置や監視を適用する
1. 攻撃されたシステムのフォレンジック解析
1. 内部のコミュニケーション
1. 法的機関の利用
1. 攻撃ベクターとして使われている可能性のある外部関係者に連絡
1. 外部とのコミュニケーション

---

## 攻撃の阻止

なんとしてでも、可能な限り早く攻撃を止めてください。
サーバーをシャットダウンしたり、ネットワークから隔離したり、必要ならデータセンターを停止してください。
一般的には以下のことを実行します。

* プロバイダーコンソールからインスタンスをシャットダウンします（フォレンジック解析が必要になるので、できればインスタンスの削除はしないでください）
* たまたまログインしていたのなら、以下のことを実行してください
    * トラフィックを制限するために、デフォルトのiptablesルールを再設定する
    * 攻撃者と思われるアクティブなセッションを`kill -9` で終了する
    * rootのわすワードを変更し、`/etc/shadow` を更新して他のユーザーをロックアウトする
    * `sudo shutdown now`

## 攻撃ベクターを遮断する

攻撃ベクターや経路と思われる物を特定し、攻撃を停止した後に使えないようにします。

* 3rdパーティーのプロバイダーに侵入されていると思われるときは、自分（および物理的にそこにいる人）以外のアカウントを削除してください。 そしてパスワーととMFAトークンを更新します。
* もしサービスアプリケーションが攻撃ベクターだと思われるときは、関連するコードパスを無効化するか、完全にシャットダウンしてください。

## 対応チームを組む

セキュリティインシデントへの主要な対応者を特定し、彼らに終止してください。
インシデントに関連する情報をやり取りする、安全な手段を確立してください。
インシデントの詳細（またはインシデントが起こったという事実さえも）、内部犯行でないと確信するまでは秘密にしておく必要があります。

* インシデントコマンダーを呼び出してないときは、呼び出してください。彼らは通常のインシデントコマンダーの役割も果たします。インシデントコマンダーチームは取るべきアクションをドキュメント化して、適した社内のステークホルダーに通知する責務があります。
* 誰かに盗聴されてもセキュリティインシデントだとわからないように、チャットやドキュメントでは、プロジェクトに無意味なコードネームを付けてください（サファイアユニコーン、など）。
* まだ音声通話をはめてない場合は開始します。
* インシデントのコードネームを使ったチャットルームを作ります。
* 全ての対応者を音声通話とチャットルームに呼び出します。
    1. **セキュリティチームは常に参加させるべきです**
    1. 影響を受けるサービスの責任者を参加させるべきです。
    1. 幹部のステークホルダーや法務部門も早期に招待スべきだが、まずは運用上の対応者を優先する
* フォレンジック解析が終わるまでは、対応チーム以外とインシデントについて連絡しない。内部から攻撃されている可能性もあります。.
* 全てのメールとチャットのトピックのプレフィクス「Attorney Work Project」を付ける

## 攻撃を受けたインスタンスを隔離する

全ての攻撃を受けたインスタンスは、すぐに他のインスタンスから隔離する必要があります。
できるだけ早くシステムのイメージを取得して、後からフォレンジック解析するために読み取り専用のストレージに保存します。

* 攻撃されたインスタンスのIPアドレスを、他のホストのブラックリストに登録します。
* 攻撃を止められなかった場合は、インスタンスをシャットダウンします。
* インスタンスに接続されているディスクのイメージを取得して、コールドストレージに移します。このイメージは読み取り専用で、改ざんできない必要があります。

## 攻撃のタイムラインを明確にする

攻撃者が何をしたかを正確に知り、攻撃のタイムラインを特定するために、ツールを使って調査する。

* 攻撃が開始する前に、攻撃者がシステム上で行ったことの偵察
* いつ攻撃者がアクセスできるようになったか
* 攻撃者がどのようなアクションをいつ行ったか
* 発見して追い出すまで、攻撃者はどのくらいシステムにアクセスしたかの特定
* 攻撃者がデータベースに対して行ったクエリの特定
* まだ攻撃者がバックドアからアクセスできるかの特定。目立ったログの監視、など。

## データ漏洩

ログファイルのフォレンジック解析、時系列グラフ、その他の情報やツールを使って、どの情報が漏洩したかを調査。

* 攻撃の途中で漏洩したデータを特定する
    * データベースからデータが抜き出されたか？
    * 漏洩したと思わるキーがシステムにあるか？
    * 攻撃者は他のシステムのコンポーネントを特定できるか（ネットワーク構成の推測など）
* どの顧客データが漏洩したか

## リスクの評価

漏洩したデータを元に、他のシステムへのリスクを考える。

* 攻撃者は他のシステムに攻撃するための十分な情報を持っていますか？
* ホストにパスワードやキーが保存されてましたか？もしそうなら保存方法に関わらず、危険にさらされているとみなす必要があります。
* 最初の攻撃に使われた可能性のあるアカウントの、キーやパスワードを全てのシステムで更新します。

## 追加の措置

システムの他の部分で追加の措置を取ります。

* 漏洩した可能性のあるデータを更新します。
* 同じような侵入を通知するために、新しいアラートを決めます。
* 攻撃に関連する全てのIPアドレスをブロックします。
* 漏洩した可能性のある全てのキーやクレデンシャルを特定して、直ちに無効化します。

## フォレンジック解析

もしシステムが安全だと自身があり、攻撃を検知できる十分なモニタリングがあるのなら、フォレンジック解析を始められます。

* 作成したリードオンリーのイメージや、アクセスログから、攻撃に関する情報を精査します。
* 何が発生して、どのように発生して、どのように母子するかを正確に特定します。
* 攻撃に関与した全てのIPアドレスを追跡してください。
* 攻撃者がシステムにもう一度アクセスしようとしてないか、ログを監視します。

## 内部コミュニケーション

バイスプレジデント (VP) または技術ディレクター(Director of Engineering)に **委譲**してください。

（フォレンジック解析により）攻撃が内部犯行でないと確信してから、内部とのコミュニケーションを図りましょう。

* あまり細かいことは言わないようにしましょう。
* タイムラインの概要を説明します。
* 緩和策について議論します。
* 判明したらより詳細をフォローアップします。

## 法的機関や外部組織との窓口

バイスプレジデント (VP) または技術ディレクター(Director of Engineering)に **委譲**してください。

法的機関と一緒に攻撃の元を特定したり、システムのオーナーに侵入された可能性があることを知らせます。

* 社内の法務部門に連絡します。
* FBIに連絡します。
* 攻撃で使用されたシステムのオペレーターに、システムが侵入された可能背があることを連絡します。
* セキュリティ会社に連絡して、リスクの評価や次にやるべき報告の助言をもらいます。
* サイバー保険会社に連絡します。

## 外部とのコミュニケーション

マーケティングチームに **委譲**してください。

全ての情報が正確で、イベントのタイムラインが確認できて、どの情報が漏洩してどのように侵入されたかがわかれば、再発防止策を講じることができます。
その上で、情報が漏洩したことと、取るべきアクションを顧客に向けて発表する必要があります。

* 新たな侵入の可能性と混同されないように、告知のタイトルに日付を入れます。
* 「我々はセキュリティに真剣に取り組んでいます」とは言わないでください。それを読むとうんざりします。
* 正直に、責任を受け入れ、事実を提供し、再発防止のために何を計画するかを伝えてうダサい。
* 可能な限り詳細なタイムラインにしてください。
* 可能な限り詳細に、どの情報が漏洩して顧客にどんな影響があるか伝えてください。保存してはいけないものを保存してた場合も正直に伝えてください。後に判明すると最悪の事態になるでしょう。
* 侵入の原因となった外部関係者の名前を上げたり恥を欠かせないようにしましょう。それは良くないです（すでに彼らが公開している場合を除く。その場合はその公表へのリンクを貼れる）。
* 可能な限り、できるのなら侵入が発覚して数日以内に、外部に公表してください。長く待てば事態は悪化します。
* もし可能なら一般公開の前に、顧客の内部のセキュリティチームと連絡をとってください。

---

## インシデント中のコミュニケーション

* 音声通話やSlackを使いましょう
* 何らかの理由で必要な場合以外はメールを避けましょう
    * メールの件名は「Attorney Work Project」でなければいけません。
    * **@pagerduty.comドメイン以外**のメールアドレスが宛先に含まれている場合、メールが暗号化されていることを確認してください。
* 紳士デントに関する連絡にはSMSを使わないでください。
    * より安全なチャンネルに誘導する場合を除きます。たとえば「Slack ASAPに参加してください」など。
* 認証が得られるまでは、インシデントを対応しているチーム外の外部に漏らさないでください。

---

## Additional Reading

* [Computer Security Incident Handling Guide](http://nvlpubs.nist.gov/nistpubs/SpecialPublications/NIST.SP.800-61r2.pdf) (NIST)
* [Incident Handler's Handbook](https://www.sans.org/reading-room/whitepapers/incident/incident-handlers-handbook-33901) (SANS)
* [Responding to IT Security Incidents](https://technet.microsoft.com/en-us/library/cc700825.aspx) (Microsoft)
* [Defining Incident Management Processes for CSIRTs: A Work in Progress](http://resources.sei.cmu.edu/library/asset-view.cfm?assetid=7153) (CMU)
* [Creating and Managing Computer Security Incident Handling Teams (CSIRTS)](https://www.first.org/conference/2008/papers/killcrece-georgia-slides.pdf) (CERT)
